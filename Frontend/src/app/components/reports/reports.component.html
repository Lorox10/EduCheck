<div class="reports-container">
    <div class="header-section">
        <button class="back-button" (click)="goBack()">‚Üê Volver</button>
        <h1>üìã Hist√≥rico de Ausencias</h1>
        <p class="subtitle">√öltimos 7 d√≠as por estudiante</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-banner">
        <span>‚ö†Ô∏è {{ errorMessage }}</span>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-spinner">
        <div class="spinner"></div>
        <p>Cargando datos...</p>
    </div>

    <!-- Filter -->
    <div *ngIf="!isLoading && availableGrades.length > 0" class="filter-section">
        <label for="grade-select">Filtrar por Grado:</label>
        <select id="grade-select" [(ngModel)]="selectedGrade" (change)="filterByGrade(selectedGrade)"
            class="grade-select">
            <option value="all">Todos los grados</option>
            <option *ngFor="let grade of availableGrades" [value]="grade">Grado {{ grade }}</option>
        </select>
    </div>

    <!-- No data message -->
    <div *ngIf="!isLoading && filteredRecords.length === 0" class="no-data-banner">
        <p>‚úÖ No hay ausencias registradas</p>
    </div>

    <!-- Records Table -->
    <div *ngIf="!isLoading && filteredRecords.length > 0" class="records-section">
        <table class="records-table">
            <thead>
                <tr>
                    <th>Nombre Completo</th>
                    <th>Grado</th>
                    <th>Documento</th>
                    <th>Ausencias (7 d√≠as)</th>
                    <th>√öltimas Faltas</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let record of filteredRecords" [class.status-ok]="record.ausencias === 0"
                    [class.status-warning]="record.ausencias > 0 && record.ausencias <= 2"
                    [class.status-critical]="record.ausencias > 2">
                    <td class="name-cell">{{ getFullName(record) }}</td>
                    <td class="grade-cell">{{ record.grado }}</td>
                    <td class="document-cell">{{ record.documento }}</td>
                    <td class="absences-cell">
                        <span class="absence-badge">{{ record.ausencias }}</span>
                    </td>
                    <td class="dates-cell">
                        <span *ngIf="record.ultimas_faltas.length === 0" class="no-absences">‚úÖ</span>
                        <span *ngFor="let fecha of record.ultimas_faltas" class="date-tag">{{ fecha }}</span>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Summary Stats -->
        <div class="summary-section">
            <div class="summary-card">
                <h3>Resumen General</h3>
                <div class="stat">
                    <span class="label">Total de estudiantes:</span>
                    <span class="value">{{ filteredRecords.length }}</span>
                </div>
                <div class="stat">
                    <span class="label">Estudiantes sin ausencias:</span>
                    <span class="value">{{ getStudentsWithoutAbsences() }}</span>
                </div>
                <div class="stat">
                    <span class="label">Total de ausencias:</span>
                    <span class="value">{{ getTotalAbsences() }}</span>
                </div>
            </div>
        </div>
    </div>
</div>